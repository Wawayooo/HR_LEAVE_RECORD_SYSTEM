{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Application for Leave</title>
  <link rel="stylesheet" href="{% static 'assets/styles/leave_req_form_style.css' %}">
</head>

<body>
  <div class="container">
    <div id="loginOverlay">
        <div id="loginDiv">
            <h3>Enter Secret Key</h3>
            <input type="password" id="secretKeyInput" placeholder="Secret Key" autocomplete="off">
            <button onclick="checkKey()">Login</button>
            <div id="loadingSpinner" style="display:none;"></div>
            <p id="loginMessage" style="color:red;"></p>
        </div>
    </div>
  </div>

  <div class="container" id="formDiv" style="display:none;">
    <div id="loginNotification">✅ Login successful!</div>
    <div class="header">
        <a href="{% url 'starting_page' %}" class="back-button">← Back</a>
        <h1>Leave Application Form</h1>
        <p>Fill out the information below to request leave</p>
    </div>

    <div id="loadingScreen" class="loading-screen" style="display:none;">
      <div class="spinner"></div>
      <p class="loading-text">Submitting your application...</p>
    </div>

    <div class="form-content">
        <div class="success-message" id="successMessage">
            Leave application submitted successfully!
        </div>

        <div class="section-title">APPLICATION FOR LEAVE</div>
        <div class="required-note">Required fields</div>

        <form id="leaveApplicationForm">
            {% csrf_token %}

            <div class="form-group">
                <label>Employee ID <span style="color:red;">*</span></label>
                <input type="text" id="employeeCode" name="employee_id" 
                    placeholder="Enter your employee ID" required autocomplete="off" maxlength="20">
                <small id="employeeValidationMsg" style="display:block; margin-top:5px; color:#666;"></small>
            </div>

            <!-- Hidden/read-only field for full name -->
            <div class="form-group" id="fullNameGroup" style="display:none;">
                <label>Full Name</label>
                <input type="text" id="employeeName" name="full_name" readonly>
            </div>

            <input type="hidden" id="remainingDays" value="0">
            <input type="hidden" id="employeeId" name="employee" value="">


            <div class="section-title">DETAILS OF LEAVE</div>

            <div class="form-group">
                <label>Type of Leave <span style="color:red;">*</span></label>
                <select id="leaveType" name="leave_type" required>
                    <option value="">Select leave type</option>
                    <option value="vacation">Vacation</option>
                    <option value="sick">Sick Leave</option>
                    <option value="maternity">Maternity Leave</option>
                    <option value="paternity">Paternity Leave</option>
                    <option value="emergency">Emergency Leave</option>
                </select>
                <div class="error-message">Leave type is required</div>
            </div>

            <div class="form-group" id="vacationLocationGroup" style="display: none;">
                <label>Where will the leave be spent? <span style="color:red;">*</span></label>
                <select id="vacationLocation" name="vacation_location">
                    <option value="">Select location</option>
                    <option value="philippines">Within the Philippines</option>
                    <option value="abroad">Abroad</option>
                </select>
                <div class="error-message">Vacation location is required</div>
            </div>

            <div class="form-group" id="sickLocationGroup" style="display: none;">
                <label>Where will the leave be spent? <span style="color:red;">*</span></label>
                <select id="sickLocation" name="sick_location">
                    <option value="">Select location</option>
                    <option value="hospital">In Hospital</option>
                    <option value="home">At Home</option>
                </select>
                <div class="error-message">Sick location is required</div>
            </div>

            <div class="form-group">
                <label>Number of Days to Leave <span style="color:red;">*</span></label>
                <input type="number" id="numberOfDays" name="number_of_days" value="1" min="1" required>
                <div class="error-message">Number of days must be at least 1 and within remaining leave days</div>
                <small style="display:block; margin-top:5px; color:#666;">
                    Remaining leave days: <strong id="remainingDaysDisplay">{{ remaining_days }}</strong>
                </small>
            </div>

            <div class="form-group">
                <label>Reason/Message (Optional)</label>
                <textarea id="reason" name="reason" rows="4" placeholder="Please provide a short message/reason for your leave request"></textarea>
            </div>

            <button type="submit" class="submit-button" id="submitButton">SUBMIT APPLICATION</button>
        </form>
    </div>
  </div>

  <script src="{% static 'assets/scripts/leave_req_script.js' %}"></script>
  <script>
    async function initCSRF() {
    try {
        await fetch(`${API_BASE_URL}/csrf/`, {
        method: 'GET',
        credentials: 'include'
        });
        console.log("CSRF cookie initialized");
    } catch (err) {
        console.error("Failed to initialize CSRF cookie:", err);
    }
    }

    document.addEventListener("DOMContentLoaded", initCSRF);
</script>

</body>
</html>