{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Osme√±a Colleges HRIS</title>
  <link rel="stylesheet" href="{% static 'assets/styles/dashboard_interface.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/dashboard_interface_2.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/general_style/other_designs.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/general_style/responsive.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/general_style/org_chart.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/general_style/envelope.css' %}">
  <link rel="stylesheet" href="{% static 'assets/styles/general_style/archive_design.css' %}">
</head>

<body>
  <div class="header">
    <div class="logo-section">
      <button class="burger" id="burgerBtn"></button>
      <div class="logo">OC</div>
      <div class="header-title">Osme√±a Colleges HRIS</div>
    </div>
    <div class="header-actions">
      <div class="admin-profile" id="adminProfile">
        <div class="admin-avatar">
          <img id="hrAvatar" src="{% static 'assets/media/examplePIC.jpg' %}" alt="HR Avatar" onerror="this.src='{{ 'https://keithcrts11.pythonanywhere.com/static/assets/media/examplePIC.jpg' }}'" />
        </div>
        <span>Admin ‚ñæ</span>

        <div class="admin-dropdown hidden" id="adminDropdown">
          <div class="dropdown-item" onclick="openDepartmentModal()">
            ‚ûï Add Department
          </div>
          <div class="dropdown-item" onclick="openPositionModal()">
            ‚ûï Add Position
          </div>
          <div class="dropdown-item" onclick="toggleHRModal()">
            üë§ View Profile
          </div>
          <div class="dropdown-item" id="toggleDeanFormBtn">
            üë®‚Äçüéì Create Dean Account
          </div>
          <div class="dropdown-item" onclick="toggleChangeKeyModal()">üîë Change Secret Key</div>
        </div>
      </div>
    </div>
  </div>

  <div id="change-key-Modal" class="hidden_DIV" style="display: none;">
    <div class="key-modal-DIV">
      <h2>Change Secret Key</h2>
      <p>Please enter a new secret key. It must be at least 8 characters long and include uppercase, lowercase, numbers, and special characters.</p>
      
      <input type="password" id="secretKeyInput" placeholder="Enter new secret key" />
      
      <div class="modal-actions-DIV">
        <button onclick="submitSecretKey()">Update Key</button>
        <button onclick="toggleChangeKeyModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="create-dean-div" class="create-dean-div hidden">
    <button id="closeDeanFormBtn" class="close-btn">&times;</button>
    <h3>Create Dean Account</h3>
    <form id="create-dean-form">
      <div class="form-group">
        <label for="dean-username">Username</label>
        <input type="text" id="dean-username" placeholder="Enter username" required>
      </div>
      <div class="form-group">
        <label for="dean-password">Password</label>
        <input type="password" id="dean-password" placeholder="Enter password" required>
      </div>
      <div class="form-group">
        <label for="dean-fullname">Full Name</label>
        <input type="text" id="dean-fullname" placeholder="Enter full name" required>
      </div>
      <div class="form-group">
        <label for="dean-department">Department</label>
        <select id="dean-department" required>
          <option value="">Select department</option>
        </select>
      </div>
      <button type="submit" class="btn-submit">Create Dean</button>
    </form>
    <p id="create-dean-message"></p>
  </div>

  <div id="hrModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>HR Profile</h2>
        <span class="close-btn" onclick="toggleHRModal()">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="profile-section">
          <img id="hrProfilePic" src="" alt="HR Profile Picture" onerror="this.src='{{ 'https://keithcrts11.pythonanywhere.com/static/assets/media/examplePIC.jpg' }}'" />
          <p><strong>Professional ID:</strong> <span id="hrProfessionalId">Loading...</span></p>
        </div>

        <form id="hrForm">
          <div class="form-group">
            <label for="hrUsername">Username</label>
            <input type="text" id="hrUsername" readonly style="background: #f5f5f5; cursor: not-allowed;" />
          </div>

          <div class="form-group">
            <label for="hrPassword">New Password (leave blank to keep current)</label>
            <input type="password" id="hrPassword" placeholder="Enter new password (optional)" />
          </div>

          <div class="form-group">
            <label for="hrFullName">Full Name</label>
            <input type="text" id="hrFullName" required />
          </div>

          <div class="form-group">
            <label for="hrGender">Gender</label>
            <select id="hrGender" required>
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="hrHeight">Height (cm)</label>
              <input type="number" id="hrHeight" min="100" max="250" step="0.1" required />
            </div>

            <div class="form-group">
              <label for="hrWeight">Weight (kg)</label>
              <input type="number" id="hrWeight" min="30" max="300" step="0.1" required />
            </div>
          </div>

          <div class="form-group">
            <label for="hrAge">Age</label>
            <input type="number" id="hrAge" min="18" max="100" required />
          </div>

          <div class="form-group">
            <label for="hrPhoto" 
                  style="border: 2px solid black; padding: 6px; cursor: pointer; border-radius: 8px; background: maroon; color: white;">
              Upload New Photo
            </label>
            <input type="file" id="hrPhoto" accept="image/*" />
            <small style="color: #666; font-size: 12px;">Max file size: 5MB. Accepted formats: JPG, PNG, GIF</small>


            <div style="margin-top:10px;">
              <img id="photoPreview" src="" alt="Selected photo preview" 
                  style="max-width:150px; border:1px solid #ccc; border-radius:8px; display:none;" />
            </div>
          </div>

          <div class="form-footer">
            <button type="button" class="btn-cancel-form" onclick="toggleHRModal()">Cancel</button>
            <button type="submit" class="btn-register">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="departmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="departmentModalTitle">Add Department</h2>
        <span class="close-btn" onclick="closeDepartmentModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form id="departmentForm">
          <div class="form-row">
            <div class="form-group-full">
              <label>Department Code</label>
              <input type="text" id="departmentCode" required placeholder="Enter department code">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group-full">
              <label>Department Name</label>
              <input type="text" id="departmentName" required placeholder="Enter department name">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group-full">
              <label>Description</label>
              <textarea id="departmentDescription" rows="3" placeholder="Enter description"></textarea>
            </div>
          </div>
          <div class="form-footer">
            <button type="button" class="btn-cancel-form" onclick="closeDepartmentModal()">Cancel</button>
            <button type="submit" class="btn-register">Save Department</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="positionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="positionModalTitle">Add Position</h2>
        <span class="close-btn" onclick="closePositionModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form id="positionForm">
          <div class="form-row">
            <div class="form-group-full">
              <label>Position Code</label>
              <input type="text" id="positionCode" required placeholder="Enter position code">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group-full">
              <label>Position Title</label>
              <input type="text" id="positionTitle" required placeholder="Enter position title">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group-full">
              <label>Description</label>
              <textarea id="positionDescription" rows="3" placeholder="Enter description"></textarea>
            </div>
          </div>
          <div class="form-footer">
            <button type="button" class="btn-cancel-form" onclick="closePositionModal()">Cancel</button>
            <button type="submit" class="btn-register">Save Position</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="sidebar" id="sidebar">
      <div class="menu-item active" data-section="dashboard">
        <span class="menu-icon">üè†</span>
        <span>Dashboard</span>
      </div>
      <div class="menu-item" data-section="facultySection">
        <span class="menu-icon">üë•</span>
        <span>Faculty & Staff</span>
      </div>
      <div class="menu-item" data-section="LeaveRequestsSection">
        <span class="menu-icon">üìã</span>
        <span>Leave Requests</span>
      </div>
      <div class="menu-item" data-section="leaveReportsSection">
        <span class="menu-icon">üìä</span>
        <span>Reports</span>
      </div>
      <div class="menu-item" data-section="archiveSection"> <span class="menu-icon">üóÑÔ∏è</span> <span>Archive</span> </div>
      <div class="menu-item" onclick="navigate('Logout')" style="position: absolute; bottom: 20px; width: 100%;">
        <span class="menu-icon">üö™</span>
        <span>Logout</span>
      </div>
    </div>

    <div class="logo-section-mobile">
      <div class="mobile-logo">OC</div>
      <div class="mobile-header-title">Osme√±a Colleges HRIS</div>
    </div>

    <div class="main-content">
      <div class="breadcrumb">
        üìÅ Dashboard / Board of Trustees
      </div>

      <div class="action-bar">
        <button class="btn-primary">+ Add Employee</button>
        <button class="btn-secondary">Update Employee</button>
        <button class="btn-secondary" id="dept_position" >Manage Positions</button>
        <button class="more-btn" onclick="showAlert('More Options')" style="display: none;">‚ãÆ</button>
      </div>

      <h1 class="page-title">Board of Trustees</h1>

      <div class="org-chart" id="orgChartContainer"></div>

    </div>

    <div id="hiddenDiv">
      <div class="hiddenDiv-content">
        <span class="hiddenDiv-close" onclick="closeHiddenDiv()">&times;</span>
        <h2>Manage Positions</h2>
        <input type="text" id="positionSearch" placeholder="Search positions...">

        <div id="positions_list"></div>
      </div>  
    </div>

    <div id="facultySection" class="faculty-section" style="display: none;">
      <div class="faculty-breadcrumb">üë®üèª‚Äçüíº Dashboard/Faculty & Staff</div>
      <h1 class="faculty-title">Faculty & Staff</h1>

      <div class="faculty-chart" id="facultyChartContainer">
      </div>
    </div>

    <div id="LeaveRequestsSection" class="leave-requests-section" style="display: none; width: 100%; height: 100%; overflow: auto; padding: 20px; margin-bottom: 20px;">
      <div class="breadcrumb">üìÅ Dashboard / Leave Requests</div>
      <h1 class="section-title">Pending Leave Requests</h1>

      <div class="leave-search" style="margin-bottom:20px; text-align:left;">
        <input type="text" id="leaveSearch"
              placeholder="üîç Search leave requests..."
              style="padding:8px 12px; border:2px solid #8B0000; border-radius:6px;
                      font-size:14px; width:100%; max-width:300px; outline:none;">
      </div>

      <div class="leave-requests-container">
        <p style="text-align: center; padding: 40px; color: #666;">Loading leave requests...</p>
      </div>
    </div>

    <div id="leaveReportsSection" class="section hidden-section" style="display: none; width: 100%; height: 100%; overflow: auto; padding: 20px; margin-bottom: 20px;">
      <div class="breadcrumb">üìÅ Dashboard / Leave Reports</div>
      <h1 class="page-title">Leave Reports</h1>

      <div class="leave-reports" style="margin-bottom:20px; text-align:left;">
        <input type="text" id="leave_Reports"
              placeholder="üîç Search leave reports..."
              style="padding:8px 12px; border:2px solid #8B0000; border-radius:6px;
                      font-size:14px; width:100%; max-width:300px; outline:none;">
      </div>

      <div class="leave-reports-cards-container">
        <p style="text-align: center; padding: 40px; color: #666;">Loading leave reports...</p>
      </div>
    </div>
    
    <div id="archiveSection" style="display: none;">
      <h2 style="color: maroon;">Archived Leave Requests</h2>
      <div class="archive-search" style="margin-bottom:20px; text-align:left;">
        <input type="text" id="archiveSearch" 
              placeholder="üîç Search archives..." 
              style="padding:8px 12px; border:3px solid #000000; border-radius:6px;
                      font-size:14px; width:250px; outline:none; width:100%;">
      </div>
      <div class="archive-container">
      </div>
    </div>

  </div>

  <div id="employeeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add Employee</h2>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-header">
          <h2>Add Employee</h2>
          <div class="auto-generated-badge">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="8" fill="#4CAF50" />
              <path d="M5 8L7 10L11 6" stroke="white" stroke-width="2" stroke-linecap="round" />
            </svg>
            <span>Auto-Generated</span>
          </div>
        </div>

        <form id="employeeForm" class="employee-form">
          <div class="form-content">
            <div class="photo-section">
              <div class="photo-upload-area">
                <div class="avatar-large" id="avatarPreview">
                  <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                    <circle cx="30" cy="30" r="30" fill="#e0e0e0" />
                    <path d="M30 28C33.866 28 37 24.866 37 21C37 17.134 33.866 14 30 14C26.134 14 23 17.134 23 21C23 24.866 26.134 28 30 28Z" fill="#999" />
                    <path d="M42 46C42 38.268 36.627 32 30 32C23.373 32 18 38.268 18 46" fill="#999" />
                  </svg>
                </div>
                <button type="button" class="upload-btn" onclick="document.getElementById('photoInput').click()">
                  <span>üì∑</span> Upload Photo
                </button>
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                <div class="file-chooser">
                  <select class="file-select">
                    <option>Choose file</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="form-fields">
              <div class="form-row">
                <div class="form-group-inline">
                  <label>Employee ID</label>
                  <input type="text" id="employeeId" readonly value="OC-20260001">
                  <div class="error-message"></div>
                </div>
                <div class="form-group-inline">
                  <label>Gender</label>
                  <select id="employeeGender" required>
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                  </select>
                  <div class="error-message"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group-inline full-width">
                  <label>Name</label>
                  <input type="text" id="employeeName" required placeholder="Enter full name">
                  <div class="error-message"></div>
                </div>
                <div class="form-group-inline">
                  <label>Weight</label>
                  <input type="number" id="employeeWeight" placeholder="kg" min="30" max="300" step="0.1" required>
                  <div class="error-message"></div>
                </div>
                <div class="form-group-inline">
                  <label>Email</label>
                  <input type="email" id="employeeEmail" placeholder="example@gmail.com" required>
                  <div class="error-message"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group-inline">
                  <label>Age</label>
                  <input type="number" id="employeeAge" placeholder="Age" min="18" max="100" required>
                  <div class="error-message"></div>
                </div>
                <div class="form-group-inline">
                  <label>Height</label>
                  <input type="number" id="employeeHeight" placeholder="cm" min="100" max="250" step="0.1" required>
                  <div class="error-message"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group-inline">
                  <label>Position Applied</label>
                  <select id="employeePosition" required>
                    <option value="">Select Position</option>
                  </select>
                  <div class="error-message"></div>
                </div>
                <div class="form-group-inline">
                  <label>Department</label>
                  <select id="employeeDepartment" required>
                    <option value="">Select Department</option>
                  </select>
                  <div class="error-message"></div>
                </div>
              </div>

              <div class="form-group-full">
                <label>Motto in Life</label>
                <textarea id="employeeMotto" rows="4" placeholder="Enter motto in life..."></textarea>
                <div class="error-message"></div>
              </div>
            </div>
          </div>

          <div class="form-footer">
            <button type="button" class="btn-cancel-form" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn-register">Register Employee</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="updateModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Update Employee</h2>
        <span class="close-btn" onclick="closeUpdateModal()">&times;</span>
      </div>
      <div class="modal-body">
        <input 
          type="text" 
          id="employeeSearch" 
          placeholder="Search employees..." 
        >
        <div class="employee-list" id="employeeList">
          <p style="text-align: center; padding: 20px;">Loading employees...</p>
        </div>
      </div>
    </div>
  </div>


  <div id="globalLoadingModal" style="
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  ">
    <div style="
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    ">
      <div class="spinner" style="
        border: 6px solid #f3f3f3;
        border-top: 6px solid #800020;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
      "></div>
      <div>Loading, please wait...</div>
    </div>
  </div>

  <style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>


  <script src="{% static 'assets/scripts/dashboard_interface.js' %}"></script>
  <script src="{% static 'assets/scripts/dean_acc_creation.js' %}"></script>
   <script src="{% static 'assets/scripts/otherLogic.js' %}"></script>

  <script>

    burgerBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        burgerBtn.classList.toggle('active');
    });
    
  </script>
</body>
</html>